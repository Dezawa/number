# このソフトの目的

 これは「数独」とか「ナンバープレース(ナンプレ)とか一般的に呼ばれているパズルの解法ソフトです。

 数独のパズルにもいろいろな性格のものがありますが、このソフトが
 解くのは、論理的に解けるもので、トライアンドエラーや総当たりで
 なければ解けないものは対象ではありません。
   Interneta上にあるパズルはトライアンドエラーが必要な質の悪いものが
   多いように思われます。

## 変わり種
 隔月雑雑 ナンプレファンの出題をターゲットにしていたので、ナンプレファンにある色物も対象となっています。
対角線、幾何、一つ違い、アロー、サム、セル、6X6、12x12、16x16、25x25 9x9をいくつか組み合わせたもの などです。通常の9x9の他に+αな条件が付きます。
https://izuito.net/puzzle に説明と例があります。

* ARROW : ○→ 矢印が通る枠の合計が○のある枠の値になる
* SUM   : 予めいくつかの枠に数字を入れるのではなく、一つ以上の枠を指定してその合計がヒントとなる
* HUTOU : 一部、マスの間に不等号があり、その大小関係から数字を予測
* DIFF  : 色物
* NEIGH : 隣接するマスが1つ違いの場所は、必ず二重線になっています
* ODD   : 偶奇をなんかしたけど忘れた。sampleなし
* KIKA  : 通常、3×3の区画が問題により形状が変化しています。
* XROSS : 対角線上でも「1～9」が重複しないという条件が加わる
* CUP   : カプセル（楕円）で囲まれた場所は、必ず奇数と偶数がペアで入ります
* COLOR : 忘れた、、sampleなし

# プログラムの構造
スタンドアロンとして呼ばれる場合のフロント部とそこから呼ばれるバック部にわけ、バック部は例えばRailsアプリに組み込みできるようにした

# 問題の定義形式
textで定義します。sample directoryにあるデータを参照してください

1. '#' で始まる行はコメントです。行頭に空白が有ってもよし。
2. 1行目がコメントの場合、次の情報が有る場合があります
    * 変わり種であることを宣言する文字列 例えば XROSS
3. 実効行1行目は問題のサイズと変わり種か？を定義します
    * 問題のサイズ
        * 9 : 9x9の普通の問題です
        * 16、25 : 16x16 または 25x25 の大きなサイズの問題です
        * 2x3、3x2 : 6x6 パズルです。6x6の中が縦2横3のとき 2x3と表記します
        * 3x4、4x3 : 12x12 のパズルです。12x12の中が縦3横4のとき 3x3と表記します
       * 9-n±m±。。。。 : 9x9の基本形を1段めn個2段めｍ個、、、並べたもの。
                   : nの段とmの段の基本形はお互いに3x3ずつ重なっている。
                    : n,m間が "-" のときはmの段は右にずれ、"+"の時は左にずれる
    *変わり種定義
        * サイズ後ろに変わり種名が来ると変わり種です
        * サイズ後ろに何もない、もしくは 変わり種名ではないものが来ると基本型です
4. 続いて 必要により変わり種の構造指定データが来ます
5. 最後に盤の初期データが来ます

## 変わり種の構造指定
クロス は指定不要。その他は盤データの前に構造を指定する。
構造の定義は後述。

## 盤データ
1. 3..5....6.7..  の様に 数値の指定のある所にはその数値を、そうでない所は数字以外を置く
2. 数字以外は何でも良いが、「偶奇」の場合は "e","o" は意味をもつ。その枠を偶奇を指定する。
3. 「9x9 のパズルだから9x9の形で書く」必要はない。81個のデータがあれば良い
4. 各枠の値の間は べた打ちでも半角空白文字を入れてもよい。  
    1. 12x12、16x16、25x25 の様に使う数字が二桁になる場合は 空白は必要。
    1. 変わり種の構造指定の場合はベタ打ちではなく空白を入れる

# 結果出力

# code構成
説明を簡潔にするため、基本形(9x9の盤、色物ではない)を暗黙の説明対象とする。

## Class
1. Game
    1. 属性
        + g :: Groupのid
    1. 関連
        + cells  → Game 全体のCellの配列。idx は cell.c
        + groups → Game 全体のGroupの配列。idx は group.g
        + arrows → Game 全体のArrowの配列。Arrowの実態は配列。
       使うのは ARROW、不等号、カプセル などの色物
        + Form → 盤面出力のためのhelper class

1. Cell
    1. 属性  
        +  c :: Cellのid
        + valu :: 確定した Cellの数字。初期値は nil
        + ability :: Cellにまだ残る 可能性有り の数字の配列
    2. 関連
        + grp_list → Cellが属するGroupの id(@g) の配列

1. Group  
  「1〜9 がもれなく入る9個のCellの集合」すなわち 行、列、3x3の正方形 の総称。
  色物「幾何」では正方形のgroupはなくそれに替えて問題で定義されたものになる
    1. 属性
        + g :: Groupのid
        + cell_list :: Groupに属する Cellの配列
    1. 関連
        + ability :: GroupAbilitis(Groupに入れるべき1〜9の数字各々が入る可能性のあるcellのidの配列)

1. GroupAbilities  
GroupAbilityの配列
    1. 関連
        * ability → GroupAbilityの配列。
	idx 0 はダミーで、idx = n が数字nのGroupAbility

1. GroupAbility
    1. 属性
        + v :: 数字
        + cell_list :: 数字が入る可能性が残っている Cellの配列
        + rest :: 可能性の残っているcellの数

1. Waku  
 9x9を複数重ねる構造の場合に、構造作成の補助として用意したもの。
 基本型では不要ではあるが、結果出力の Form を共通のものにするために、
 基本型でも使うことにした。  
 が、、、  
 複雑になっちまったので「積み重ねの時の特別処理にする」か悩んでる。
 
1. Box  
Wakuでの構造定義のためのHelper class。

## 初期化の流れ
1. Game
    1. new
    1. self.structure
        * make_waku_pform
            + base_size → form_typeを元に、盤の形のためのパラメータ取得
            + base_pos  → base_sizeに従って boxを作る
            + @waku = Waku.new
                  boxesに対応してCellと1:1なWakuSub作成
            + @cellsの入れ物準備
            + @waku.set_grp → Group作成
            + optional_grp → 色物固有の追加group有る場合(今は XROSSだけ?)
            
        * ban_initialize → Cell作成。Groupのcell_list、ability設定。
        * @form = Form.new
    1. self.data_initialize → infileを読んでcellの初期値設定。Arrow読み込む
    
