# frozen_string_literal: true

module Number
  # mail class
  class Waku
    attr_accessor :waku, :boxes, :xmax, :game
    def initialize(game, boxes, game_scale, m_nr, xmax, ymax)
      cell_no = 0
      @waku = []
      @game = game
      @boxes = boxes
      @xmax = xmax
      boxes[0..m_nr].each do |box|
        (box.y_pos..box.y_pos + game_scale - 1).map do |y|
          (box.x_pos..box.x_pos + game_scale - 1).map do |x|
            @waku << WakuSub.new(cell_no)
            cell_no += 1
          end
          @waku << WakuSub.new(nil)
        end
        @waku += [WakuSub.new(nil)] * xmax
      end
      @waku
    end

    def set_grp(group_width, group_hight)
      gnr = 0
      gnr = set_vertical_holizontal_group(gnr)
      gnr = set_block_group(gnr, group_width, group_hight)
      set_optional_group(gnr, group_width, group_hight)
    end
    
    def set_vertical_holizontal_group(gnr)
      boxes.each do |box|
        (box.y_pos..box.y_pos + game_scale - 1).each do |y|
          holizontal_group(gnr, box, y)
          gnr += 1
        end
        (box.x_pos..box.x_pos + game_scale - 1).each do |x|
          vertical_group(gnr, box, x)
          gnr += 1
        end
      end
      gnr
    end

    def holizontal_group(gnr, box, y_pos)
      # @groups[gnr] =  Group.new(@cells,gnr,game_scale,:holizontal)
      game.groups[gnr] = Number::Group.new(game, gnr, @count, :holizontal)
      (box.x_pos..box.x_pos + game_scale - 1).each do |x|
        pp [:holizontal_group,waku[xmax * y_pos + x]]
        waku[xmax * y_pos + x][1] << gnr
      end
    end

    def vertical_group(gnr, box, x_pos)
      # @groups[gnr] =  Group.new(@cells,gnr,game_scale,:vertical)
      game.groups[gnr] = Number::Group.new(game, gnr, count, :vertical)
      (box.y_pos..box.y_pos + game_scale - 1).each { |y| waku[xmax * y + x_pos][1] << gnr }
    end
  end

  class WakuSub
    attr_accessor :cell_no, :group_list

    def initialize(cell_n)
      @cell_no = cell_n if cell_n
      @group_list = []
    end

    def [](idx)
      return cell_no if idx.zero?
      return group_list if idx == 1
    end

    def inspect
      return nil unless cell_no

      "[#{cell_no}, #{group_list}]"
    end
  end
end
